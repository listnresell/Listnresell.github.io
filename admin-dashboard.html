<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard - Support Tickets</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
  <header class="bg-white shadow p-4 flex items-center justify-between">
    <h1 class="text-2xl font-semibold text-gray-800 flex items-center space-x-2">
      <i class="fas fa-tachometer-alt"></i>
      <span>Admin Dashboard - Support Tickets</span>
    </h1>
    <a
      href="support-ticket.html"
      class="text-blue-600 hover:text-blue-800 flex items-center space-x-1"
      ><i class="fas fa-plus-circle"></i><span>New Ticket</span></a
    >
  </header>

  <main class="flex-grow max-w-7xl mx-auto p-6 w-full">
    <section>
      <h2 class="text-xl font-semibold text-gray-700 mb-4">Support Tickets</h2>
      <div class="overflow-x-auto bg-white rounded-lg shadow">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-100">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Ticket ID
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Email
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Subject
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Description
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Status
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Created At
              </th>
            </tr>
          </thead>
          <tbody id="ticketsTableBody" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    // Utility to format ISO date string to readable format
    function formatDate(isoString) {
      const d = new Date(isoString);
      return d.toLocaleString(undefined, {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
      });
    }

    // Load tickets from localStorage
    function loadTickets() {
      const tickets = JSON.parse(localStorage.getItem('supportTickets')) || [];
      return tickets;
    }

    // Render tickets table rows
    function renderTickets() {
      const tickets = loadTickets();
      const tbody = document.getElementById('ticketsTableBody');
      tbody.innerHTML = '';

      if (tickets.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 6;
        td.className = 'px-6 py-4 text-center text-gray-500';
        td.textContent = 'No support tickets found.';
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      tickets.forEach((ticket) => {
        const tr = document.createElement('tr');

        // Ticket ID
        const tdId = document.createElement('td');
        tdId.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-mono';
        tdId.textContent = ticket.id;
        tr.appendChild(tdId);

        // Email
        const tdEmail = document.createElement('td');
        tdEmail.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-700';
        tdEmail.textContent = ticket.email;
        tr.appendChild(tdEmail);

        // Subject
        const tdSubject = document.createElement('td');
        tdSubject.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-semibold';
        tdSubject.textContent = ticket.subject;
        tr.appendChild(tdSubject);

        // Description (truncate if too long)
        const tdDesc = document.createElement('td');
        tdDesc.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-600 max-w-xs truncate';
        tdDesc.title = ticket.description;
        tdDesc.textContent = ticket.description;
        tr.appendChild(tdDesc);

        // Status
        const tdStatus = document.createElement('td');
        tdStatus.className = 'px-6 py-4 whitespace-nowrap text-sm';
        const statusSpan = document.createElement('span');
        statusSpan.className =
          ticket.status === 'Open'
            ? 'px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800'
            : 'px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-300 text-gray-700';
        statusSpan.textContent = ticket.status;
        tdStatus.appendChild(statusSpan);
        tr.appendChild(tdStatus);

        // Created At
        const tdCreated = document.createElement('td');
        tdCreated.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
        tdCreated.textContent = formatDate(ticket.createdAt);
        tr.appendChild(tdCreated);

        tbody.appendChild(tr);
      });
    }

    // Initial render
    renderTickets();
  </script>
</body>
</html>
